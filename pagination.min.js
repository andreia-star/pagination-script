(function(){
  const postResults = typeof postPerPage != "undefined" ? postPerPage : 7;
  const numOfPages = 2;
  let pageOf = ["Página", "de"];
  let currentPage = "";
  let currentPageNo = 1;
  let noPage = 1;
  let postLabel = "";
  let locationUrl = location.href;
  let home_page = "/";

  function startPagination(totalPosts) {
    const lastPageNo = Math.ceil(totalPosts / postResults);
    let pageStart = Math.max(currentPageNo - Math.floor(numOfPages / 2), 1);
    let pageEnd = Math.min(pageStart + numOfPages - 1, lastPageNo);
    let html = `<span class="page-of">${pageOf[0]} ${currentPageNo} ${pageOf[1]} ${lastPageNo}</span>`;

    if (currentPageNo > 1) {
      html += `<a class="page-num page-prev" href="#" onclick="${currentPage === 'page' ? 'getPage' : 'getLabelPage'}(${currentPageNo - 1});return false;">«</a>`;
    }

    for (let i = pageStart; i <= pageEnd; i++) {
      if (i === parseInt(currentPageNo)) {
        html += `<span class="page-num page-active">${i}</span>`;
      } else {
        html += `<a class="page-num" href="#" onclick="${currentPage === 'page' ? 'getPage' : 'getLabelPage'}(${i});return false;">${i}</a>`;
      }
    }

    if (currentPageNo < lastPageNo) {
      html += `<a class="page-num page-next" href="#" onclick="${currentPage === 'page' ? 'getPage' : 'getLabelPage'}(${currentPageNo + 1});return false;">»</a>`;
    }

    document.querySelectorAll('[name="pageArea"]').forEach(el => el.innerHTML = html);
  }

  function dataFeed(a) {
    const total = parseInt(a.feed.openSearch$totalResults.$t, 10);
    startPagination(total);
  }

  function findPostDate(a) {
    if (!a.feed || !a.feed.entry || a.feed.entry.length === 0) return;
    const post = a.feed.entry[0];
    const date = encodeURIComponent(post.published.$t.substring(0, 19) + post.published.$t.substring(23, 29));
    const d = currentPage === "page"
      ? `/search?updated-max=${date}&max-results=${postResults}#PageNo=${noPage}`
      : `/search/label/${postLabel}?updated-max=${date}&max-results=${postResults}#PageNo=${noPage}`;

    location.replace(d.replace("?m=1", "").replace("&m=1", ""));
  }

  function getPage(n) {
    noPage = n;
    const s = document.createElement("script");
    const start = (n - 1) * postResults;
    s.src = `${home_page}feeds/posts/summary?start-index=${start}&max-results=1&alt=json-in-script&callback=findPostDate`;
    document.head.appendChild(s);
  }

  function getLabelPage(n) {
    noPage = n;
    const s = document.createElement("script");
    const start = (n - 1) * postResults;
    s.src = `${home_page}feeds/posts/summary/-/${postLabel}?start-index=${start}&max-results=1&alt=json-in-script&callback=findPostDate`;
    document.head.appendChild(s);
  }

  function pageCurrentBlogger() {
    if (locationUrl.includes("/search/label/")) {
      currentPage = "label";
      const labelMatch = locationUrl.match(/\/search\/label\/([^?]+)/);
      postLabel = labelMatch ? decodeURIComponent(labelMatch[1]) : "";
    } else {
      currentPage = "page";
    }

    currentPageNo = locationUrl.includes("#PageNo=")
      ? parseInt(locationUrl.split("#PageNo=")[1]) || 1
      : 1;

    const s = document.createElement("script");
    s.src = currentPage === "page"
      ? `${home_page}feeds/posts/summary?max-results=1&alt=json-in-script&callback=dataFeed`
      : `${home_page}feeds/posts/summary/-/${postLabel}?alt=json-in-script&callback=dataFeed&max-results=1`;
    document.head.appendChild(s);
  }

  document.addEventListener("DOMContentLoaded", pageCurrentBlogger);
})();
//]]>
