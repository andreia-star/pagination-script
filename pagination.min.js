var postResults = typeof postPerPage != "undefined" ? postPerPage : 7,
    numOfPages = 2,
    pageOf = ["Page", "of"],
    noPage, currentPage, currentPageNo, postLabel,
    locationUrl = location.href,
    home_page = "/";

function startPagination(a) {
  var b = "";
  pageNumber = parseInt(numOfPages / 2);
  if (pageNumber == numOfPages - pageNumber) {
    numOfPages = pageNumber * 2 + 1;
  }
  pageStart = currentPageNo - pageNumber;
  if (pageStart < 1) pageStart = 1;
  lastPageNo = parseInt(a / postResults) + 1;
  if (lastPageNo - 1 == a / postResults) lastPageNo--;
  pageEnd = pageStart + numOfPages - 1;
  if (pageEnd > lastPageNo) pageEnd = lastPageNo;

  b += '<span class="page-of">' + pageOf[0] + " " + currentPageNo + " " + pageOf[1] + " " + lastPageNo + "</span>";
  var c = parseInt(currentPageNo) - 1;

  if (currentPageNo > 1) {
    if (currentPageNo == 2) {
      b += currentPage == "page"
        ? '<a class="page-num page-prev" href="' + home_page + '"></a>'
        : '<a class="page-num page-prev" href="/search/label/' + postLabel + '?&max-results=' + postResults + '"></a>';
    } else {
      b += currentPage == "page"
        ? '<a class="page-num page-prev" href="#" onclick="getPage(' + c + ');return false" aria-label="Página anterior" title="Página anterior"></a>'
        : '<a class="page-num page-prev" href="#" onclick="getLabelPage(' + c + ');return false"></a>';
    }
  }

  if (pageStart > 1) {
    b += currentPage == "page"
      ? '<a class="page-num" href="' + home_page + '">1</a>'
      : '<a class="page-num" href="/search/label/' + postLabel + '?&max-results=' + postResults + '">1</a>';
  }

  if (pageStart > 2) {
    b += '<span class="page-num page-dots">...</span>';
  }

  for (var d = pageStart; d <= pageEnd; d++) {
    if (currentPageNo == d) {
      b += '<span class="page-num page-active">' + d + "</span>";
    } else if (d == 1) {
      b += currentPage == "page"
        ? '<a class="page-num" href="' + home_page + '">1</a>'
        : '<a class="page-num" href="/search/label/' + postLabel + '?&max-results=' + postResults + '">1</a>';
    } else {
      b += currentPage == "page"
        ? '<a class="page-num" href="#" onclick="getPage(' + d + ');return false">' + d + "</a>"
        : '<a class="page-num" href="#" onclick="getLabelPage(' + d + ');return false">' + d + "</a>";
    }
  }

  if (pageEnd < lastPageNo - 1) {
    b += '<span class="page-num page-dots">...</span>';
  }

  if (pageEnd < lastPageNo) {
    b += currentPage == "page"
      ? '<a class="page-num" href="#" onclick="getPage(' + lastPageNo + ');return false">' + lastPageNo + "</a>"
      : '<a class="page-num" href="#" onclick="getLabelPage(' + lastPageNo + ');return false">' + lastPageNo + "</a>";
  }

  var e = parseInt(currentPageNo) + 1;
  if (currentPageNo < lastPageNo) {
    b += currentPage == "page"
      ? '<a class="page-num page-next" href="#" onclick="getPage(' + e + ');return false" aria-label="Próxima página" title="Próxima página"></a>'
      : '<a class="page-num page-next" href="#" onclick="getLabelPage(' + e + ');return false"></a>';
  }

  document.querySelectorAll('[name="pageArea"]').forEach(el => el.innerHTML = b);
  var g = document.getElementById("blog-pager");
  if (g) g.innerHTML = b;
}

function dataFeed(a) {
  var b = a.feed,
      c = parseInt(b.openSearch$totalResults.$t, 10);
  startPagination(c);
}

function pageCurrentBlogger() {
  var a = locationUrl;
  if (a.indexOf("/search/label/") != -1) {
    postLabel = a.indexOf("?updated-max") != -1
      ? a.substring(a.indexOf("/search/label/") + 14, a.indexOf("?updated-max"))
      : a.substring(a.indexOf("/search/label/") + 14, a.indexOf("?&max"));
  }
  if (a.indexOf("?q=") == -1 && a.indexOf(".html") == -1) {
    if (a.indexOf("/search/label/") == -1) {
      currentPage = "page";
      currentPageNo = locationUrl.indexOf("#PageNo=") != -1
        ? locationUrl.substring(locationUrl.indexOf("#PageNo=") + 8)
        : 1;
      var s = document.createElement("script");
      s.src = home_page + "feeds/posts/summary?max-results=1&alt=json-in-script&callback=dataFeed";
      document.head.appendChild(s);
    } else {
      currentPage = "label";
      if (a.indexOf("&max-results=") == -1) {
        postResults = 20;
      }
      currentPageNo = locationUrl.indexOf("#PageNo=") != -1
        ? locationUrl.substring(locationUrl.indexOf("#PageNo=") + 8)
        : 1;
      var s = document.createElement("script");
      s.src = home_page + "feeds/posts/summary/-/" + postLabel + "?alt=json-in-script&callback=dataFeed&max-results=1";
      document.head.appendChild(s);
    }
  }
}

function getPage(a) {
  jsonstart = (a - 1) * postResults;
  noPage = a;
  var s = document.createElement("script");
  s.src = home_page + "feeds/posts/summary?start-index=" + jsonstart + "&max-results=1&alt=json-in-script&callback=findPostDate";
  document.head.appendChild(s);
}

function getLabelPage(a) {
  jsonstart = (a - 1) * postResults;
  noPage = a;
  var s = document.createElement("script");
  s.src = home_page + "feeds/posts/summary/-/" + postLabel + "?start-index=" + jsonstart + "&max-results=1&alt=json-in-script&callback=findPostDate";
  document.head.appendChild(s);
}

function findPostDate(a) {
  if (!a.feed.entry || a.feed.entry.length === 0) {
    console.warn("Nenhum post encontrado para essa página.");
    return;
  }

  var post = a.feed.entry[0],
      b = post.published.$t.substring(0, 19) + post.published.$t.substring(23, 29),
      c = encodeURIComponent(b),
      d = currentPage == "page"
        ? "/search?updated-max=" + c + "&max-results=" + postResults + "#PageNo=" + noPage
        : "/search/label/" + postLabel + "?updated-max=" + c + "&max-results=" + postResults + "#PageNo=" + noPage;

  if (location.href !== d) {
    location.replace(d.);
  }
}

// Agora sim fora da função:
pageCurrentBlogger();
